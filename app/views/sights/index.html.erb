<% content_for :css do %>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=yes" />
    <%= stylesheet_link_tag("map") %>
    <%= stylesheet_link_tag "sights" %>
<% end %>

<% content_for :javascript do %>
    <%= javascript_include_tag("https://maps.google.com/maps/api/js?sensor=false") %>
<% end %>

<% content_for :body do %>

    <script type="text/javascript">
        $(document).ready(function() {
            var bounds = new google.maps.LatLngBounds();
            var myOptions = { mapTypeId: google.maps.MapTypeId.ROADMAP };
            var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
            <% @sights.each do |sight| %>
                var latlng = new google.maps.LatLng(<%= sight.latitude %>, <%= sight.longitude %>);
                bounds.extend (latlng);
                var marker = new google.maps.Marker({
                    position: latlng,
                    title:"<%= sight.name %>",
                    map: map
                });
                var circle = new google.maps.Circle({
                    radius: <%= sight.radius %>, center: latlng, map: map, strokeWeight: 1
                });
                google.maps.event.addListener(marker, 'click', function() {
                    window.location = '<%= sight_path sight %>';
                });
            <% end %>
            
            map.fitBounds (bounds);
        });
    </script>
    
    <div id="map_canvas"></div>
    
    <h1>Listing sights</h1>
    
    <table id="sight-table">
        <tr>
            <th>Latitude</th>
            <th>Longitude</th>
            <th>Name</th>
            <th>Radius</th>
            <th></th>
            <th></th>
        </tr>
        
        <% @sights.each do |sight| %>
            <tr>
                <td><%= link_to sight.name, sight %></td>
                <td><%= number_with_precision(sight.latitude, :precision => 2) %></td>
                <td><%= number_with_precision(sight.longitude, :precision => 2) %></td>
                <td><%= sight.radius %></td>
            </tr>
        <% end %>
    </table>
    
    <br />

<% end %>
